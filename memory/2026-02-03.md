# 2026-02-03 - Zaki Platform Session

## Configuration
- **Brave Search API key configured**: `BSAfSuO5KayX20G-1-EDFJpJqkClUwI` via `gateway config.patch` at `tools.web.search.apiKey`
- Web search now working (rate limited: 1 req/sec on free plan)

## Cloudflare Pricing Research
- **Workers Paid**: $5/mo includes 25 GiB-hours memory, 375 vCPU-min, 200 GB-hours disk
- **R2**: $0.015/GB-month (10GB free, no egress fees)
- **Containers**: Scale to zero (charged only when running)
- **Instance types**: "lite" (1/16 vCPU, 256MB) to "standard-4" (4 vCPU, 12GB)

## LobeChat Research
- Open-source AI chat platform
- MCP plugin system (10,000+ skills)
- Agent groups feature
- Personal memory system
- Multi-model support

## Architecture Decisions
- **Multi-tenant via Sandbox ID**: `user-{userId}` per user
- **R2 per-user prefix**: `users/{userId}/` for data isolation
- **OpenClaw pre-installed in Docker image**: Faster startup
- **Gateway port**: 18789 (standard)
- **Use `@cloudflare/sandbox`**: Not `@cloudflare/containers` - matches Moltworker pattern

## Key Files
- `/root/zaki-platform/wrangler.jsonc` - Cloudflare config (switched from wrangler.toml)
- `/root/zaki-platform/src/index.ts` - Main Worker entry (exports `Sandbox` from `@cloudflare/sandbox`)
- `/root/zaki-platform/src/sandbox/manager.ts` - Uses `getSandbox(env.Sandbox, sandboxId)`
- `/root/zaki-platform/Dockerfile` - Container image (Node.js 22, clawdbot@2026.1.24-3)
- `/root/zaki-platform/start-zaki.sh` - Gateway startup

## Infrastructure Setup Completed
- ✅ Cloudflare API token created (Workers/R2/Containers permissions)
- ✅ R2 bucket created: `zaki-user-storage`
- ✅ Docker + buildx installed on VM
- ✅ Wrangler OAuth login completed (has `containers (write)` permission)
- ✅ Workers Paid plan enabled ($5/mo)
- ✅ Worker uploaded successfully (177.69 KiB)
- ✅ Docker cache cleared (reclaimed 4.354GB)

## Dockerfile Optimizations Applied
- Added `rm -rf /var/lib/apt/lists/*` after apt installs
- Added `npm cache clean --force` after npm install
- Single RUN layer for clawdbot install + cache cleanup
- Original image: 3293MB, limit: 2000MB
- Build session ended - need to verify final image size

## Blockers
- ⚠️ **Docker image size**: Original 3293MB > 2GB limit - optimized build result unknown
- Brave Search API rate limited (Free plan: 1 req/sec)

## Next Steps (Priority Order)
1. Check Docker image size after optimization
2. If still >2GB: Multi-stage build or smaller base image
3. Test single Sandbox initialization
4. Verify R2 mounting works
5. Test multi-tenant isolation

## Business Model (Tiered)
- **Starter**: $15-20/mo - 1 agent, basic features
- **Pro**: $40-50/mo - 3 agents, more channels
- **Business**: $100-150/mo - 10 agents, voice, priority
- **Voice add-on**: ~$1-3/hour (Deepgram + ElevenLabs)
